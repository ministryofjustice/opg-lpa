{% extends 'layout/twig/accordion-header.twig' %}

{% block content %}

{% import "application/macros.twig" as macros %}

{# Error messages #}
{% set form = formErrorTextExchange(form, {
    'how' : {
        'Value is required and can\'t be empty' : 'Please choose how your attorneys make decisions',
    },
    'howDetails': {
    	'Value is required and can\'t be empty' : 'Please tell us which decisions have to be made jointly, and which can be made jointly and severally'
	}
}) %}

{# Set form fields variables #}
{% set how = form.get('how') %}
{% set howDetails = form.get('howDetails') %}
{% set currentHowValueOptions = how.getOptions()['value_options'] %}

{# form fields config #}
{{ howDetails.setAttributes({
    id: 'howDetails',
    rows: 10,
    cols: 67,
    maxlength: 2000,
    class: 'form-control'
}) ? ''}}
    
{% set howValueOptions = {
	'jointly-attorney-severally' :{
		attributes: {
			id: 'how-jointly-attorney-severally'
		},
		label: '<strong class="bold-small">Jointly and severally</strong><span class="text form-hint form-hint--strong">
			Attorneys can make decisions on their own or together. Most people choose this option because it’s the most practical.
			</span>',
		label_attributes: {
			for: 'how-jointly-attorney-severally'
		},
		value: currentHowValueOptions['jointly-attorney-severally'].value
	},
	'jointly' : {
		attributes: {
			id: 'how-jointly'
		},
		label: '<strong class="bold-small">Jointly</strong><span class="text form-hint form-hint--strong">
			Attorneys must agree unanimously on every decision, however big or small. If one of your attorneys can no longer act the others will no longer be able to act.
			</span>',
		label_attributes: {
			for: 'how-jointly'
		},
		value: currentHowValueOptions['jointly'].value 
	},
	'depends' : {
		attributes: {
			id: 'how-depends'
		},
		label: '<strong class="text bold-small">Jointly for some decisions, and jointly and severally
			for other decisions</strong><span class="text form-hint form-hint--strong">
			Attorneys must agree unanimously on some decisions, but can make others on their own. You’ll need to state which decisions need to be agreed unanimously.
			</span>',
		label_attributes: {
			for: 'how-depends',
			'data-target': 'decisions-details'
		},
		value: currentHowValueOptions['depends'].value
	}
}%}

{{ how.setOptions({
	value_options: howValueOptions,
	label_attributes: {'class': 'text block-label'}
}) ? '' }}

{{ how.setLabelOptions({
	disable_html_escape: true
}) ? '' }}

{# form fields labels #}
{{ howDetails.setOptions({label:'Details'}) ? '' }}

<li id="primary-attorney-decision-sections" class="section current js-current">

	<h2 class="heading-medium accordion-header flush--top">How should your attorneys make decisions?</h2>
	
    <div class="accordion-info">
		<div class="text">
			<p>Your choice here is very important as it affects how your LPA can be used. Whichever option you choose, your attorneys must always act in your best interests.</p>
			<p><a class="js-guidance" href="/guide#topic-how-attorneys-make-decisions" data-journey-click="stageprompt.lpa:help:how-attorneys-make-decisions">Get help with making this decision</a></p>
		</div>
	</div>

	{# begin form #}
    {{ form.prepare() ? '' }}
    {{ form().openTag( form )|raw }} 
        {{ formElement(form.get( form.csrfName )) }}

		{{ macros.formErrorSummary(error,form,'There was a problem submitting the form') }}

		<fieldset id="how">
            <legend class="visuallyhidden">How should the attorneys make decisions?</legend>

            <h2 class="heading-medium flush--top">How should the attorneys make decisions?</h2>

            <div class="form-group {{ how.getMessages|length > 0 ? 'error'}}">
                {{ formElement(how) }}
                {{ formElementErrorsV2(how) }}
            </div>
        </fieldset>

		<fieldset id="decisions-details" style="display: none;">
            <legend class="visuallyhidden">How should the attorneys make decisions?</legend>

			<p class="text">Please tell us which decisions have to be made jointly, and which can be made jointly and severally. <a class="js-guidance" href="/guide#topic-how-attorneys-make-decisions" data-journey-click="stageprompt.lpa:help:how-attorneys-make-decisions">Take a look at the guidance</a> for examples of how to make your wishes clear.</p>

			{{ macros.formGroup(howDetails) }}

        </fieldset>

        <div class="form-group">
            <input type="submit" name="save" value="Save and continue" class="button">
        </div>
        
    {{ form().closeTag|raw }}

</li>

{% endblock %}
