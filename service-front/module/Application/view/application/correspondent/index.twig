{% extends 'layout/twig/accordion-header.twig' %}

{% block content %}

{% import "application/macros.twig" as macros %}

{# Error messages #}
{% set form = formErrorTextExchange(form, {
    'correspondence' : {
        "at-least-one-option-needs-to-be-selected" : "At least one option must be selected",
		"phone-number" : {
				"cannot-be-blank" : "Please enter the phone number"
		},
		"invalid-phone-number" : {
			"phone-number" : "Phone"
		}
    }
}) %}

{# Set form fields variables #}
{% set correspondence = form.get('correspondence') %}
{% set contactByEmail = correspondence.get('contactByEmail') %}
{% set contactByPhone = correspondence.get('contactByPhone') %}
{% set contactByPost  = correspondence.get('contactByPost') %}
{% set contactInWelsh = correspondence.get('contactInWelsh') %}
{% set email = correspondence.get('email-address') %}
{% set phone = correspondence.get('phone-number') %}

{# form fields config #}
{{ contactByPost.setAttributes({
	id: 'contactByPost'
}) ? '' }}

{{ contactByPost.setOptions({
	use_hidden_element: true
}) ? '' }}

{{ contactByPhone.setAttributes({
	id: 'contactByPhone'
}) ? '' }}

{{ contactByPhone.setOptions({ 
	use_hidden_element: true
}) ? '' }}

{{ contactByEmail.setAttributes({
	id: 'contactByEmail'
}) ? '' }}

{{ contactByEmail.setOptions({
	use_hidden_element: true
}) ? '' }}

{{ contactInWelsh.setAttributes({
	id: 'contactInWelsh'
}) ? '' }}

{{ contactInWelsh.setOptions({
	use_hidden_element: true
}) ? '' }}

{{ phone.setAttributes({
	id: 'phone-number',
	class: 'form-control'
}) ? '' }}

{{ email.setAttributes({
	id: 'email-address',
	class: 'form-control'
}) ? '' }}


{# form fields labels #}
{{ contactByPost.setOptions({
	label: 'Post'
}) ? '' }}

{{ contactByPhone.setOptions({
	label: ((correspondent['contactPhone']) ? 'Phone (' ~ correspondent['contactPhone'] ~ ')' : 'Phone')
}) ? '' }}

{{ contactByEmail.setOptions({
	label: ((correspondent['contactEmail']) ? 'Email (' ~ correspondent['contactEmail'] ~ ')' : 'Email')
}) ? '' }}

{{ contactInWelsh.setOptions({
	label: 'In Welsh'
}) ? '' }}

{{ phone.setOptions({
	label: 'Phone number'
}) ? '' }}

{{ email.setOptions({
	label: 'Email address'
}) ? '' }}

<li id="correspondent-section" class="section current js-current">

	<h2 class="heading-medium accordion-header flush--top">Where should we send the LPA and any correspondence?</h2>

    <div class="accordion-info">

		<div class="text">

			<p>We'll normally write to the applicant if we have any questions and send them the LPA once weâ€™ve registered it.</p>

            <p>However, you might prefer to choose someone else, such as a legal professional, to take care of these things.</p>

            <p>If you want someone who isn't the applicant to receive the LPA and any related correspondence, enter their details below.</p>

            <p><a href="/guide#topic-correspondence-address" class="js-guidance" data-journey-click="stageprompt.lpa:help:correspondence-address">Find out more about the correspondence address</a></p>

		</div>
	</div>

	<h3 class="heading-medium flush--top">The Correspondent</h3>

	<div class="person">
        <h3 class="person-name heading-small flush--ends">{{ correspondent['name'] }}</h3>
        <p class="person-address flush--ends">{{ correspondent['address'] }}</p>
        <ul class="person-actions">
            <li class="action-item">
                <a href="{{ editRoute }}" class="action-edit js-form-popup">Change this</a>
            </li>
        </ul>
    </div>

    {# begin form #}
	{{ form.prepare() ? '' }}
	{{ form().openTag( form )|raw }}
	    {{ formElement(form.get( form.csrfName )) }}

	    {{ macros.formErrorSummary(error,form,'There was a problem submitting the form') }}

	    <h3 class="heading-medium flush--top">How would the person above prefer to be contacted?</h3>

        <fieldset>
        	<legend class="visuallyhidden">Contact options</legend>

            <p>You can choose more than one.</p>

            <div class="form-group {{ correspondence.getMessages|length >0 ? 'error'}}">
	            <label class="text block-label" for="{{ contactByPost.getAttribute('id') }}">
	                {{ formElement(contactByPost) }}
	                {{ contactByPost.getOption('label')|raw }}
	            </label>
                {{ formElementErrorsV2(contactByPost) }}

	            <label class="text block-label" {{ (correspondent['contactPhone']) ? '' : 'data-target="contact-by-phone"' }} for="{{ contactByPhone.getAttribute('id') }}">
	                {{ formElement(contactByPhone) }}
	                {{ contactByPhone.getOption('label')|raw }}
	            </label>
                <div class="panel panel-border-narrow js-hidden" id="contact-by-phone">
                	<label class="form-label" for="{{ phone.getAttribute('id') }}">
                        {{ phone.getOption('label') }}
                        {{ formElementErrorsV2(phone) }}
                    </label>
                    {{ formText(phone) }}
                </div>
                {{ formElementErrorsV2(contactByPhone) }}

	            <label class="text block-label" {{ (correspondent['contactEmail']) ? '' : 'data-target="contact-by-email"' }} for="{{ contactByEmail.getAttribute('id') }}">
	                {{ formElement(contactByEmail) }}
	                {{ contactByEmail.getOption('label')|raw }}
	            </label>
                <div class="panel panel-border-narrow js-hidden" id="contact-by-email">
                	<label class="form-label" for="{{ email.getAttribute('id') }}">
                        {{ email.getOption('label') }}
                        {{ formElementErrorsV2(email) }}
                    </label>
                    {{ formText(email) }}
                </div>
                {{ formElementErrorsV2(contactByEmail) }}

	            <label class="text block-label" for="{{ contactInWelsh.getAttribute('id') }}">
	                {{ formElement(contactInWelsh) }}
	                {{ contactInWelsh.getOption('label')|raw }}
	            </label>
                {{ formElementErrorsV2(contactInWelsh) }}
		        
		        {{ formElementErrorsV2(correspondence) }}

            </div>

        </fieldset>

        <div class="form-group">
            <input type="submit" name="save" value="Save and continue" class="button">
        </div>

	{{ form().closeTag|raw }}

</li>

{% endblock %}
