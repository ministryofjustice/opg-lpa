{% import "application/authenticated/lpa/summary/partials/macros.twig" as macros %}

<table class="table-summary" itemtype="http://schema.org/Organization" itemscope>

    <caption class="visually-hidden">Summary table</caption>

    <tbody>

        {# LPA TYPE #}
        {% if lpa.document.type is defined %}
            <tr class="group-single">
                <th class="table-summary-title" scope="row">Type of LPA</th>
                <td class="table-summary-content" itemprop="name">
                    {{ lpa.document.type == 'health-and-welfare' ? 'Health and welfare' : 'Property and finance' }}
                </td>
                <td class="table-summary-action"></td>
            </tr>
        {% endif %}

        {# DONOR #}
        {% if lpa.document.donor is defined %}

            <tr class="group-start">
                <td class="table-summary-heading" colspan="3">
                    <h3 class="heading-small">Donor</h3>
                </td>
            </tr>

            {{ macros.outputActor( lpa.document.donor, url('lpa/donor', {'lpa-id': lpa.id}), 'Donor' ) }}

        {% endif %}

        {# Can Sustain Life #}
        {% if lpa.document.primaryAttorneyDecisions is defined and lpa.document.type is defined and lpa.document.type == 'health-and-welfare' %}
            <tr class="group-single">
                <th class="table-summary-title" scope="row">Life-sustaining treatment</th>
                <td class="table-summary-content">
                    {{ lpa.document.primaryAttorneyDecisions.canSustainLife ? 'The attorneys can make decisions about life-sustaining treatment' : 'The attorneys cannot make decisions about life-sustaining treatment' }}
                </td>
                <td class="table-summary-action"><a href="{{ url('lpa/life-sustaining', {'lpa-id': lpa.id}) }}" data-journey-click="check your answers:link:navigation: Life-sustaining treatment">Edit</a></td>
            </tr>
        {% endif %}

        {# WHEN LPA STARTS #}
        {% if lpa.document.type is defined and lpa.document.primaryAttorneyDecisions.when is defined and lpa.document.type == 'property-and-financial' %}
            <tr class="group-single">
                <th class="table-summary-title" scope="row">My LPA can be used</th>
                <td class="table-summary-content">
                    {{ lpa.document.primaryAttorneyDecisions.when == 'now' ? 'As soon as it\'s registered (and with the donor\'s consent)' : 'Only if the donor does not have mental capacity' }}
                </td>
                <td class="table-summary-action"><a href="{{ url('lpa/when-lpa-starts', {'lpa-id': lpa.id}) }}" data-journey-click="check your answers:link:navigation: When LPA starts">Edit</a></td>
            </tr>
        {% endif %}

        {# PRIMARY ATTORNEYS #}
        {% if lpa.document.primaryAttorneys is defined and lpa.document.primaryAttorneys|length > 0 %}

            {% for key,attorney in lpa.document.primaryAttorneys %}

                <tr class="group-start">
                    <td class="table-summary-heading" colspan="3">
                        <h3 class="heading-small">
                            {% if lpa.document.primaryAttorneys|length > 1 %}
                                {{ ordinalSuffix(loop.index) }} attorney
                            {% else %}
                                Attorney
                            {% endif %}
                        </h3>
                    </td>
                </tr>

                {{ macros.outputActor( attorney, url('lpa/primary-attorney', {'lpa-id': lpa.id}), 'Primary attorney' ) }}

            {% endfor %}

        {% endif %}


        {# HOW PRIMARY ATTORNEYS MAKE DECISIONS #}
        {% if lpa.document.primaryAttorneyDecisions is defined and lpa.document.primaryAttorneyDecisions.how is not empty %}

            <tr class="group-start">
                <td class="table-summary-heading" colspan="3">
                    <h3 class="heading-small">Attorney decisions</h3>
                </td>
            </tr>

            <tr class="{{ lpa.document.primaryAttorneyDecisions.howDetails is not empty ? 'group-element' : 'group-end' }}">
                <th class="table-summary-title" scope="row">How decisions are made</th>
                <td class="table-summary-content" itemprop="name">
                    {{ 'The attorneys will act ' ~ ( lpa.document.primaryAttorneyDecisions.how == 'jointly-attorney-severally' ?
                    'jointly and severally' :
                    ((lpa.document.primaryAttorneyDecisions.how == 'jointly' ) ?
                    'jointly' :
                    'jointly for some decisions, and jointly and severally for other decisions')) }}
                </td>
                <td class="table-summary-action"><a href="{{ url('lpa/how-primary-attorneys-make-decision', {'lpa-id': lpa.id}) }}" data-journey-click="check your answers:link:navigation: How primary attorneys make decisions">Edit</a></td>
            </tr>


            {# HOW PRIMARY ATTORNEYS MAKE DECISIONS - Details #}
            {% if lpa.document.primaryAttorneyDecisions is defined and lpa.document.primaryAttorneyDecisions.howDetails is not empty %}
                <tr class="group-end">
                    <th class="table-summary-title" scope="row">Decisions that attorneys must make jointly</th>
                    <td class="table-summary-content" itemprop="name">
                        {{ lpa.document.primaryAttorneyDecisions.howDetails }}
                    </td>
                    <td class="table-summary-action"></td>
                </tr>
            {% endif %}

        {% endif %}

        {# REPLACEMENT ATTORNEY #}
        {% if lpa.document.replacementAttorneys is defined and lpa.document.replacementAttorneys|length > 0 %}

            {% for key,attorney in lpa.document.replacementAttorneys %}

                <tr class="group-start">
                    <td class="table-summary-heading" colspan="3">
                        <h3 class="heading-small">
                            {% if lpa.document.replacementAttorneys|length > 1 %}
                                {{ ordinalSuffix(loop.index) }} replacement attorney
                            {% else %}
                                Replacement attorney
                            {% endif %}
                        </h3>
                    </td>
                </tr>

                {{ macros.outputActor( attorney, url('lpa/replacement-attorney', {'lpa-id': lpa.id}), 'Replacement attorney' ) }}

            {% endfor %}
        {% else %}
            <tr class="group-single">
                <td class="table-summary-title">Replacement attorney</td>
                <td class="table-summary-content">No replacement attorneys</td>
                <td class="table-summary-action"><a href="{{ url('lpa/replacement-attorney', {'lpa-id': lpa.id}) }}" data-journey-click="check your answers:link:navigation: Replacement attorney">Edit</a></td>
            </tr>
        {% endif %}

        {# WHEN REPLACEMENT ATTORNEYS STEP IN #}
        {% if lpa.document.replacementAttorneyDecisions is defined and
        (lpa.document.replacementAttorneyDecisions.when is not empty or lpa.document.replacementAttorneyDecisions.how is not empty) %}

            <tr class="group-start">
                <td class="table-summary-heading" colspan="3">
                    <h3 class="heading-small">Replacement attorney decisions</h3>
                </td>
            </tr>

            {% if lpa.document.replacementAttorneyDecisions.when is not empty %}
                <tr class="{{ (lpa.document.replacementAttorneyDecisions.how is not empty
                           or lpa.document.replacementAttorneyDecisions.howDetails is not empty
                           or lpa.document.replacementAttorneyDecisions.whenDetails is not empty) ? 'group-element' : 'group-end' }}">
                    <th class="table-summary-title" scope="row">When they step in</th>
                    <td class="table-summary-content" itemprop="name">
                        {{ 'The replacement attorneys will ' ~
                        ( lpa.document.replacementAttorneyDecisions.when == 'first' ?
                            'step in as soon as one of the original attorneys can no longer act' :
                            ((lpa.document.replacementAttorneyDecisions.when == 'last' ) ?
                                'only step in when none of the original attorneys can act' :
                                'step in according to the donor\'s instructions below')) }}
                    </td>
                    <td class="table-summary-action"><a href="{{ url('lpa/when-replacement-attorney-step-in', {'lpa-id': lpa.id}) }}" data-journey-click="check your answers:link:navigation: When replacement attorneys step in">Edit</a></td>
                </tr>
            {% endif %}

            {# WHEN REPLACEMENT ATTORNEYS MAKE DECISIONS - Details #}
            {% if lpa.document.replacementAttorneyDecisions.whenDetails is not empty %}
                <tr class="{{ (lpa.document.replacementAttorneyDecisions.how is not empty
                           or lpa.document.replacementAttorneyDecisions.howDetails is not empty) ? 'group-element' : 'group-end' }}">
                    <th class="table-summary-title" scope="row">Donor's instructions on how replacements step in</th>
                    <td class="table-summary-content" itemprop="name">
                        {{ lpa.document.replacementAttorneyDecisions.whenDetails }}
                    </td>
                    <td class="table-summary-action"></td>
                </tr>
            {% endif %}

            {% if lpa.document.replacementAttorneyDecisions.how is not empty %}
                <tr class="{{ lpa.document.replacementAttorneyDecisions.howDetails is not empty ? 'group-element' : 'group-end' }}">
                    <th class="table-summary-title" scope="row">How decisions are made</th>
                    <td class="table-summary-content" itemprop="name">
                        {{ 'The replacement attorneys will act ' ~
                        ( lpa.document.replacementAttorneyDecisions.how == 'jointly-attorney-severally' ?
                        'jointly and severally' :
                        ((lpa.document.replacementAttorneyDecisions.how == 'jointly' ) ?
                        'jointly' :
                        'jointly for some decisions, and jointly and severally for other decisions')) }}
                    </td>
                    <td class="table-summary-action"><a href="{{ url('lpa/how-replacement-attorneys-make-decision', {'lpa-id': lpa.id}) }}" data-journey-click="check your answers:link:navigation: How replacement attorneys make decision">Edit</a></td>
                </tr>
            {% endif %}

            {# HOW REPLACEMENT ATTORNEYS MAKE DECISIONS - Details #}
            {% if lpa.document.replacementAttorneyDecisions.howDetails is not empty %}
                <tr class="{{ lpa.document.replacementAttorneyDecisions.whenDetails is not empty ? 'group-element' : 'group-end' }}">
                    <th class="table-summary-title" scope="row">Decisions that replacement attorneys must make jointly</th>
                    <td class="table-summary-content" itemprop="name">
                        {{ lpa.document.replacementAttorneyDecisions.howDetails }}
                    </td>
                    <td class="table-summary-action"></td>
                </tr>
            {% endif %}

        {% endif %}

        {# CERTIFICATE PROVIDER #}
        {% if ( lpa.document.certificateProvider ) %}
            <tr class="group-start">
                <td class="table-summary-heading" colspan="3">
                    <h3 class="heading-small">Certificate provider</h3>
                </td>
            </tr>

           {{ macros.outputActor( lpa.document.certificateProvider, url('lpa/certificate-provider', {'lpa-id': lpa.id}), 'Certificate provider' ) }}
        {% else %}
            <tr class="group-single">
                <td class="table-summary-title">Certificate provider</td>
                <td class="table-summary-content incomplete">Who is the certificate provider?</td>
                <td class="table-summary-action"><a href="{{ url('lpa/certificate-provider', {'lpa-id': lpa.id}) }}" data-journey-click="check your answers:link:navigation: Certificate provider">Edit</a></td>
            </tr>
        {% endif %}

        {# PEOPLE TO NOTIFY #}
        {% if lpa.document.peopleToNotify is defined and lpa.document.peopleToNotify|length > 0 %}

            {% for key,actor in lpa.document.peopleToNotify %}

                <tr class="group-start">
                    <td class="table-summary-heading" colspan="3">
                        <h3 class="heading-small">
                            {% if lpa.document.peopleToNotify|length > 1 %}
                                {{ ordinalSuffix(loop.index) }} person to notify
                            {% else %}
                                Person to notify
                            {% endif %}
                        </h3>
                    </td>
                </tr>

                {{ macros.outputActor( actor, url('lpa/people-to-notify', {'lpa-id': lpa.id}), 'People to notify' ) }}

            {% endfor %}

        {% else %}
            <tr class="group-single">
                <td class="table-summary-title">Person to notify</td>
                <td class="table-summary-content">No people to notify</td>
                <td class="table-summary-action"><a href="{{ url('lpa/people-to-notify', {'lpa-id': lpa.id}) }}" data-journey-click="check your answers:link:navigation: People to notify">Edit</a></td>
            </tr>
        {% endif %}

        {# ATTORNEY PREFERENCES #}
        {% if lpa.document.preference is defined and lpa.document.preference is not empty %}
            <tr class="group-single">
                <th class="table-summary-title" scope="row">Preferences</th>
                <td class="table-summary-content">{{ lpa.document.preference }}</td>
                <td class="table-summary-action"><a href="{{ url('lpa/instructions', {'lpa-id': lpa.id}) }}" data-journey-click="check your answers:link:navigation: Preferences">Edit</a></td>
            </tr>

        {% else %}
            <tr class="group-single">
                <td class="table-summary-title">Preferences</td>
                <td class="table-summary-content">No preferences</td>
                <td class="table-summary-action"><a href="{{ url('lpa/instructions', {'lpa-id': lpa.id}) }}" data-journey-click="check your answers:link:navigation: Preferences">Edit</a></td>
            </tr>
        {% endif %}

        {# ATTORNEY INSTRUCTIONS #}
        {% if lpa.document.instruction is defined and lpa.document.instruction is not empty %}
            <tr class="group-single">
                <th class="table-summary-title" scope="row">Instructions</th>
                <td class="table-summary-content">{{ lpa.document.instruction }}</td>
                <td class="table-summary-action"><a href="{{ url('lpa/instructions', {'lpa-id': lpa.id}) }}" data-journey-click="check your answers:link:navigation: Instructions">Edit</a></td>
            </tr>

        {% else %}
            <tr class="group-single">
                <td class="table-summary-title">Instructions</td>
                <td class="table-summary-content">No instructions</td>
                <td class="table-summary-action"><a href="{{ url('lpa/instructions', {'lpa-id': lpa.id}) }}" data-journey-click="check your answers:link:navigation: Instructions">Edit</a></td>
            </tr>
        {% endif %}

        {# Who is Registering #}
        {% if lpa.document.whoIsRegistering is defined and lpa.document.whoIsRegistering is not empty %}
            <tr class="group-single">
                <th class="table-summary-title" scope="row">Who is registering the LPA</th>
                <td class="table-summary-content" itemprop="name">
                    {% if lpa.document.whoIsRegistering == 'donor' %}
                        Donor
                    {% else %}
                        {{ applicantNames( lpa ) }}
                    {% endif %}
                </td>
                <td class="table-summary-action"><a href="{{ url('lpa/applicant', {'lpa-id': lpa.id}) }}" data-journey-click="check your answers:link:navigation: Applicant">Edit</a></td>
            </tr>
        {% endif %}

        {# Correspondent #}
        {% if lpa.document.correspondent is defined %}

            <tr class="group-start">
                <td class="table-summary-heading" colspan="3">
                    <h3 class="heading-small">Correspondent</h3>
                </td>
            </tr>

            {{ macros.outputActor( lpa.document.correspondent, url('lpa/correspondent', {'lpa-id': lpa.id}), 'Correspondent' ) }}

        {% endif %}

        {# Repeat Applicaiton. Correspondent is checked as we only show this post-then #}
        {% if lpa.metadata['repeat-application-confirmed'] is defined %}
            <tr class="group-single">
                <th class="table-summary-title" scope="row">Repeat application</th>
                <td class="table-summary-content" itemprop="name">
                    {{ lpa.repeatCaseNumber is not empty ? 'This is a repeat application with case number ' ~ lpa.repeatCaseNumber
                    : "This is not a repeat application" }}
                </td>
                <td class="table-summary-action"><a href="{{ url('lpa/repeat-application', {'lpa-id': lpa.id}) }}" data-journey-click="check your answers:link:navigation: Repeat application">Edit</a></td>
            </tr>
        {% endif %}


        {# Fee #}
        {% if lpa.payment is defined %}
            <tr class="group-single">
                <th class="table-summary-title" scope="row">Application fee</th>
                <td class="table-summary-content" itemprop="name">
                    {% if lpa.payment.reducedFeeReceivesBenefits %}
                        Application fee: £0 as the donor is claiming an eligible benefit
                    {% elseif lpa.payment.reducedFeeUniversalCredit %}
                        Fee assessed on application as the donor receives Universal Credit
                    {% elseif lpa.payment.reducedFeeLowIncome %}
                        Application fee: £{{ lowIncomeFee }} as the donor has an income of less than £12,000
                    {% else %}
                        Application fee: £{{ fullFee }} as you are not claiming a reduction
                    {% endif %}
                </td>
                <td class="table-summary-action"><a href="{{ url('lpa/fee-reduction', {'lpa-id': lpa.id}) }}" data-journey-click="check your answers:link:navigation: Fee reduction">Edit</a></td>
            </tr>
        {% endif %}

    </tbody>

</table>
