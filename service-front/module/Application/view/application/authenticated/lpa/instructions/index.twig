{% extends 'layout/twig/accordion-layout.twig' %}

{% block htmlTitle %}Preferences and instructions - {% endblock %}

{% block content %}

{% import "application/macros.twig" as macros %}

{# Error messages #}
{% set form = formErrorTextExchange(form, {
    'instruction' : {
        'must-be-less-than-or-equal:10000' : 'Please limit your instructions to 10,000 characters',
        'expected-type:string-or-bool=false' : 'Please re-enter your instructions'
    },
    'preference' : {
        'must-be-less-than-or-equal:10000' : 'Please limit your preferences to 10,000 characters',
        'expected-type:string-or-bool=false' : 'Please re-enter your preferences'
    }
}) %}

{# Set form fields variables #}
{% set instructions = form.get('instruction') %}
{% set preferences = form.get('preference') %}

{# form fields config #}
{{ instructions.setAttributes({
    id: 'instruction',
    rows: 10,
    cols: 67,
    maxlength: 10000,
    class: 'form-control'
}) ? ''}}

{{ preferences.setAttributes({
    id: 'preferences',
    rows: 10,
    cols: 67,
    maxlength: 10000,
    class: 'form-control'
}) ? ''}}

{# form fields labels #}
{{ instructions.setOptions({label: 'Instructions'}) ? '' }}
{{ preferences.setOptions({label: 'Preferences'}) ? '' }}

{% set lpaType = (lpa.document.type == 'health-and-welfare') ? 'health and welfare' : 'property and financial affairs' %}

<li id="preferences-and-instructions-section" class="section current">

    <h2 class="heading-medium accordion-header flush--top">Preferences and instructions</h2>

    <div class="accordion-info">
        <div class="text">

            <p>You've entered all the essential information needed for your {{ lpaType }} LPA.</p>

            <p>The optional section below lets you add <a class="js-guidance" href="/guide#topic-preferences-and-instructions" data-journey-click="page:link:help: lets you add -preferences or instructions- for your attorneys">preferences or instructions</a> for your attorneys. You do not have to put anything there, but you can state things that the attorneys must or must not do or give guidance that you'd like them to follow.</p>

            <p>
                {% if isPfLpa %}
                    For example, you could add preferences about making charitable donations or managing your bank accounts. You could add instructions about giving gifts, managing investments or seeking professional tax advice.
                {% else %}
                    For example, you could add preferences about where you'd like to live or taking exercise. You could add instructions about your diet or medical treatment that fits with your beliefs.
                {% endif %}
            </p>
        </div>
    </div>


    {# begin form #}
    {{ form.prepare() ? '' }}
    {{ form().openTag( form )|raw }}
        {{ formElement(form.getCsrf) }}

        <details{{ instructions.getValue() or preferences.getValue() ? ' open' : '' }} class="form-group">

            <summary data-journey-click="page:link.reveal:Add extra preferences or instructions for the attorneys? (optional)" role="button" aria-expanded="false">Add extra preferences or instructions for the attorneys? (optional)</summary>

            <div>

                <div class="form-group text flush--bottom">
                    <p>If you'd like to add anything here, please <a class="js-guidance" href="/guide#topic-preferences-and-instructions" data-journey-click="page:link:help: read our help topic on preferences and instructions">read our help topic on preferences and instructions</a>. It contains useful examples and can help you avoid mistakes.</p>
                </div>

                <fieldset>
                    <legend class="visually-hidden">Preferences and instructions</legend>

                    <div class="form-group {{ preferences.getMessages|length >0 ? 'error'}}">
                        <label class="form-label text" for="{{ preferences.getAttribute('id') }}">
                            {{ preferences.getOption('label') }}<br>
                            <span class="form-hint">These are things you would like attorneys to think about when making decisions. Use words like 'prefer' or 'would like'. <a href="/guide#topic-preferences-and-instructions" class="js-guidance" data-journey-click="page:link:help: Not sure what to put? (Preferences)">Not sure what to put?</a><br></span>
                            {{ formElementErrorsV2(preferences) }}
                        </label>
                        {{ formElement(preferences) }}
                    </div>

                    <div class="form-group {{ instructions.getMessages|length >0 ? 'error'}} flush--bottom">
                        <label class="form-label text" for="{{ instructions.getAttribute('id') }}">
                            {{ instructions.getOption('label') }}<br>
                            <span class="form-hint">These are things that the attorneys MUST or MUST NOT do. Use words like 'must' or 'have to'. <a href="/guide#topic-preferences-and-instructions" class="js-guidance" data-journey-click="page:link:help: Not sure what to put? (Instructions)">Not sure what to put?</a><br></span>
                            {{ formElementErrorsV2(instructions) }}
                        </label>
                        {{ formElement(instructions) }}
                    </div>

                </fieldset>

            </div>
        </details>

        {{ formElement(form.get('save')) }}

    {{ form().closeTag|raw }}

</li>

{% endblock %}
