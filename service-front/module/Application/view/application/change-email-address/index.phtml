<?php

$form = $this->formErrorTextExchange($this->form, []);

$password       = $form->get('password_current');
$email          = $form->get('email');
$email_confirm  = $form->get('email_confirm');

$password->setAttributes([
    'id' => 'password_current',
    'autocomplete' => 'off'
])->setOptions( ['label' => 'Your account password'] );

$email->setAttributes([
    'id' => 'email',
    'autocomplete' => 'off'
])->setOptions( ['label' => 'New email address'] );

$email_confirm->setAttributes([
    'id' => 'email_confirm',
    'autocomplete' => 'off'
])->setOptions( ['label' => 'Re-enter new email address'] );


$form->prepare();

//---

$formLabel = $this->plugin('formLabel');

?>
<?= $this->form()->openTag( $form->setAttribute( 'class', 'account form' ) ); ?>

<div class="<?= $this->elementGroupClass($form->get('secret')) ?>">
    <?= $this->formElement($form->get('secret')) ?>
</div>

<? if (isset($this->error) || count($form->getMessages()) > 0) { ?>
    <div class="validation-summary group" role="alert" aria-labelledby="error-heading" tabindex="-1">
        <h1 id="error-heading">There was a problem submitting the form</h1>
        <p>Because of the following problems:</p>
        <ol>
            <?php
            $this->formLinkedErrorList($form);

            if (isset($this->error)) {
                echo '<li><a href="">';
                switch($this->error){
                    default:
                        echo $this->escapehtml( $this->error );
                }
                echo '</a></li>';
            }
            ?>
        </ol>
    </div>
<? } ?>

<fieldset>

    <div class="group">
        <label>Current email address</label>
        <input type="email" value="<?= $this->escapeHtmlAttr($this->currentAddress) ?>" autocomplete="off" disabled="disabled">
    </div>

    <? $element = $password; ?>
    <div class="group">
        <?= $formLabel->openTag() . $element->getOption('label') . $formLabel->closeTag(); ?>
        <?= $this->formElement($element) ?>
        <?= $this->formElementErrors($element) ?>
    </div>

    <? $element = $email; ?>
    <div class="group">
        <?= $formLabel->openTag() . $element->getOption('label') . $formLabel->closeTag(); ?>
        <?= $this->formElement($element) ?>
        <?= $this->formElementErrors($element) ?>
    </div>

    <? $element = $email_confirm; ?>
    <div class="group">
        <?= $formLabel->openTag() . $element->getOption('label') . $formLabel->closeTag(); ?>
        <?= $this->formElement($element) ?>
        <?= $this->formElementErrors($element) ?>
    </div>

</fieldset>


<p class="action group">
    <input type="submit" name="submit" id="signin-form-submit" value="Save new email address" class="button">
</p>

<?= $this->form()->closeTag(); ?>
