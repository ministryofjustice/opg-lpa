{% import "application/summary/partials/macros.twig" as macros %}

<table class="table-summary" itemtype="http://schema.org/Organization" itemscope>

	<caption class="visuallyhidden">Caption to identify a table</caption>
	
	<tbody>

		{# LPA TYPE #}
		{% if lpa.document.type is defined %}
			<tr class="group-single">
				<th class="table-summary-title" scope="row">Type of LPA</th>
				<td class="table-summary-content" itemprop="name">
					{{ lpa.document.type == 'health-and-welfare' ? 'Health and welfare' : 'Property and finance' }}
				</td>
				<td class="table-summary-action"><a href="{{ url('lpa/form-type', {'lpa-id': lpa.id}) }}">View</a></td>
			</tr>
		{% endif %}

		{# DONOR #}
		{% if lpa.document.donor is defined %}

			<tr class="group-start">
				<td class="table-summary-heading" colspan="3">
					<h3 class="heading-small">Donor</h3>
				</td>
			</tr>

			{{ macros.outputActor( lpa.document.donor, url('lpa/donor', {'lpa-id': lpa.id}) ) }}

			{% if lpa.document.donor.canSign is defined %}
				<tr class="group-end">
					<th class="table-summary-title" scope="row">I can physically sign the LPA</th>
					<td class="table-summary-content">{{ lpa.document.donor.canSign ? 'Yes' : 'No' }}</td>
					<td class="table-summary-action"></td>
				</tr>
			{% endif %}

		{% endif %}

		{# Can Sustain Life #}
		{% if lpa.document.primaryAttorneyDecisions is defined and lpa.document.type is defined and lpa.document.type == 'health-and-welfare' %}
			<tr class="group-single">
				<th class="table-summary-title" scope="row">Life-sustaining treatment</th>
				<td class="table-summary-content">
					{{ lpa.document.primaryAttorneyDecisions.canSustainLife ? 'The attorneys can make decisions' : 'The attorneys cannot make decisions' }}
				</td>
				<td class="table-summary-action"><a href="{{ url('lpa/life-sustaining', {'lpa-id': lpa.id}) }}">Edit</a></td>
			</tr>
		{% endif %}

		{# WHEN LPA STARTS #}
		{% if lpa.document.type is defined and lpa.document.primaryAttorneyDecisions.when is defined and lpa.document.type == 'property-and-financial' %}
			<tr class="group-single">
				<th class="table-summary-title" scope="row">My LPA can be used</th>
				<td class="table-summary-content">
					{{ lpa.document.primaryAttorneyDecisions.when == 'now' ? 'As soon as it\'s registered (with my consent)' : 'Only if I don\'t have mental capacity' }}
				</td>
				<td class="table-summary-action"><a href="{{ url('lpa/when-lpa-starts', {'lpa-id': lpa.id}) }}">Edit</a></td>
			</tr>
		{% endif %}

		{# PRIMARY ATTORNEYS #}
		{% if lpa.document.primaryAttorneys is defined and lpa.document.primaryAttorneys|length > 0 %}

			{% for key,attorney in lpa.document.primaryAttorneys %}

				<tr class="group-start">
					<td class="table-summary-heading" colspan="3">
						<h3 class="heading-small">
							{% if lpa.document.primaryAttorneys|length > 1 %}
								{{ ordinalSuffix(loop.index) }} primary attorney
							{% else %}
								Primary attorney
							{% endif %}
						</h3>
					</td>
				</tr>

				{{ macros.outputActor( attorney, url('lpa/primary-attorney', {'lpa-id': lpa.id}) ) }}

			{% endfor %}

		{% endif %}


		{# HOW PRIMARY ATTORNEYS MAKE DECISIONS #}
		{% if lpa.document.primaryAttorneyDecisions is defined and lpa.document.primaryAttorneyDecisions.how is not empty %}

			<tr class="group-start">
				<td class="table-summary-heading" colspan="3">
					<h3 class="heading-small">Primary attorney decisions</h3>
				</td>
			</tr>

			<tr class="{{ lpa.document.primaryAttorneyDecisions.howDetails is not empty ? 'group-element' : 'group-end' }}">
				<th class="table-summary-title" scope="row">How decisions are made</th>
				<td class="table-summary-content" itemprop="name">
					{{ 'The attorneys will act ' ~ ( lpa.document.primaryAttorneyDecisions.how == 'jointly-attorney-severally' ?
					'jointly and severally' :
					((lpa.document.primaryAttorneyDecisions.how == 'jointly' ) ?
					'jointly' :
					'jointly for some decisions, and jointly and severally for other decisions')) }}
				</td>
				<td class="table-summary-action"><a href="{{ url('lpa/how-primary-attorneys-make-decision', {'lpa-id': lpa.id}) }}">Edit</a></td>
			</tr>


			{# HOW PRIMARY ATTORNEYS MAKE DECISIONS - Details #}
			{% if lpa.document.primaryAttorneyDecisions is defined and lpa.document.primaryAttorneyDecisions.howDetails is not empty %}
				<tr class="group-end">
					<th class="table-summary-title" scope="row">Details</th>
					<td class="table-summary-content" itemprop="name">
						{{ lpa.document.primaryAttorneyDecisions.howDetails }}
					</td>
					<td class="table-summary-action"></td>
				</tr>
			{% endif %}

		{% endif %}

		{# REPLACEMENT ATTORNEY #}
		{% if lpa.document.replacementAttorneys is defined and lpa.document.replacementAttorneys|length > 0 %}

			{% for key,attorney in lpa.document.replacementAttorneys %}

				<tr class="group-start">
					<td class="table-summary-heading" colspan="3">
						<h3 class="heading-small">
							{% if lpa.document.replacementAttorneys|length > 1 %}
								{{ ordinalSuffix(loop.index) }} replacement attorney
							{% else %}
								Replacement attorney
							{% endif %}
						</h3>
					</td>
				</tr>

				{{ macros.outputActor( attorney, url('lpa/replacement-attorney', {'lpa-id': lpa.id}) ) }}

			{% endfor %}

		{% endif %}


		{# WHEN REPLACEMENT ATTORNEYS STEP IN #}
		{% if lpa.document.replacementAttorneyDecisions is defined and lpa.document.replacementAttorneyDecisions.when is not empty %}

			<tr class="group-start">
				<td class="table-summary-heading" colspan="3">
					<h3 class="heading-small">Replacement attorney decisions</h3>
				</td>
			</tr>

			<tr class="{{ (lpa.document.replacementAttorneyDecisions.how is not empty
			or lpa.document.replacementAttorneyDecisions.howDetails is not empty
			or lpa.document.replacementAttorneyDecisions.whenDetails is not empty) ? 'group-element' : 'group-end' }}">
				<th class="table-summary-title" scope="row">When they step in</th>
				<td class="table-summary-content" itemprop="name">
					{{ 'The replacement attorneys will step in ' ~
					( lpa.document.replacementAttorneyDecisions.when == 'first' ?
					'as soon as one of the original attorneys can no longer act' :
					((lpa.document.replacementAttorneyDecisions.when == 'last' ) ?
					'as soon as none of the original attorneys can act' :
					'as per instructions')) }}
				</td>
				<td class="table-summary-action"><a href="{{ url('lpa/when-replacement-attorney-step-in', {'lpa-id': lpa.id}) }}">Edit</a></td>
			</tr>

			{% if lpa.document.replacementAttorneyDecisions.how is not empty %}
				<tr class="{{ (lpa.document.replacementAttorneyDecisions.howDetails is not empty
				or lpa.document.replacementAttorneyDecisions.whenDetails is not empty) ? 'group-element' : 'group-end' }}">
					<th class="table-summary-title" scope="row">How decisions are made</th>
					<td class="table-summary-content" itemprop="name">
						{{ 'The replacement attorneys will act ' ~
						( lpa.document.replacementAttorneyDecisions.how == 'jointly-attorney-severally' ?
						'jointly and severally' :
						((lpa.document.replacementAttorneyDecisions.how == 'jointly' ) ?
						'jointly' :
						'jointly for some decisions, and jointly and severally for other decisions')) }}
					</td>
					<td class="table-summary-action"><a href="{{ url('lpa/how-replacement-attorneys-make-decision', {'lpa-id': lpa.id}) }}">Edit</a></td>
				</tr>
			{% endif %}

			{# HOW REPLACEMENT ATTORNEYS MAKE DECISIONS - Details #}
			{% if lpa.document.replacementAttorneyDecisions.howDetails is not empty %}
				<tr class="{{ lpa.document.replacementAttorneyDecisions.whenDetails is not empty ? 'group-element' : 'group-end' }}">
					<th class="table-summary-title" scope="row">Details of how</th>
					<td class="table-summary-content" itemprop="name">
						{{ lpa.document.replacementAttorneyDecisions.howDetails }}
					</td>
					<td class="table-summary-action"></td>
				</tr>
			{% endif %}

			{# WHEN REPLACEMENT ATTORNEYS MAKE DECISIONS - Details #}
			{% if lpa.document.replacementAttorneyDecisions.whenDetails is not empty %}
				<tr class="group-end">
					<th class="table-summary-title" scope="row">Details of when</th>
					<td class="table-summary-content" itemprop="name">
						{{ lpa.document.replacementAttorneyDecisions.whenDetails }}
					</td>
					<td class="table-summary-action"></td>
				</tr>
			{% endif %}

		{% endif %}


		{# CERTIFICATE PROVIDER #}
		{% if lpa.document.certificateProvider is defined %}

			<tr class="group-start">
				<td class="table-summary-heading" colspan="3">
					<h3 class="heading-small">Certificate provider</h3>
				</td>
			</tr>

			{{ macros.outputActor( lpa.document.certificateProvider, url('lpa/certificate-provider', {'lpa-id': lpa.id}) ) }}

		{% endif %}


		{# PEOPLE TO NOTIFY #}
		{% if lpa.document.peopleToNotify is defined and lpa.document.peopleToNotify|length > 0 %}

			{% for key,actor in lpa.document.peopleToNotify %}

				<tr class="group-start">
					<td class="table-summary-heading" colspan="3">
						<h3 class="heading-small">
							{% if lpa.document.peopleToNotify|length > 1 %}
								{{ ordinalSuffix(loop.index) }} person to notify
							{% else %}
								Person to notify
							{% endif %}
						</h3>
					</td>
				</tr>

				{{ macros.outputActor( actor, url('lpa/people-to-notify', {'lpa-id': lpa.id}) ) }}

			{% endfor %}

		{% endif %}

		{# ATTORNEY INSTRUCTIONS #}
		{% if lpa.document.instruction is defined and lpa.document.instruction is not empty %}
			<tr class="group-single">
				<th class="table-summary-title" scope="row">Instructions</th>
				<td class="table-summary-content">{{ lpa.document.instruction }}</td>
				<td class="table-summary-action"><a href="{{ url('lpa/instructions', {'lpa-id': lpa.id}) }}">Edit</a></td>
			</tr>
		{% endif %}

		{# ATTORNEY PREFERENCES #}
		{% if lpa.document.preference is defined and lpa.document.preference is not empty %}
			<tr class="group-single">
				<th class="table-summary-title" scope="row">Preferences</th>
				<td class="table-summary-content">{{ lpa.document.preference }}</td>
				<td class="table-summary-action"><a href="{{ url('lpa/instructions', {'lpa-id': lpa.id}) }}">Edit</a></td>
			</tr>
		{% endif %}

		{# Who is Registering #}
		{% if lpa.document.whoIsRegistering is defined and lpa.document.whoIsRegistering is not empty %}
			<tr class="group-single">
				<th class="table-summary-title" scope="row">Who is registering the LPA</th>
				<td class="table-summary-content" itemprop="name">
					{% if lpa.document.whoIsRegistering == 'donor' %}
						Donor
					{% else %}
						{{ applicantNames( lpa ) }}
					{% endif %}
				</td>
				<td class="table-summary-action"><a href="{{ url('lpa/applicant', {'lpa-id': lpa.id}) }}">Edit</a></td>
			</tr>
		{% endif %}

		{# Correspondence #}
		{% if lpa.document.correspondent is defined %}

			<tr class="group-start">
				<td class="table-summary-heading" colspan="3">
					<h3 class="heading-small">Correspondent</h3>
				</td>
			</tr>

			{{ macros.outputActor( lpa.document.correspondent, url('lpa/correspondent', {'lpa-id': lpa.id}) ) }}

		{% endif %}

		{# Reapeat Applicaiton. Correspondent is checked as we only show this post-then #}
		{% if lpa.document.correspondent is defined %}
			<tr class="group-single">
				<th class="table-summary-title" scope="row">Repeat application</th>
				<td class="table-summary-content" itemprop="name">
					{{ lpa.repeatCaseNumber is not empty ? 'This is a repeat application with case number ' ~ lpa.repeatCaseNumber
					: "This is not a repeat application" }}
				</td>
				<td class="table-summary-action"><a href="{{ url('lpa/repeat-application', {'lpa-id': lpa.id}) }}">Edit</a></td>
			</tr>
		{% endif %}


		{# Fee #}
		{% if lpa.payment is defined %}
			<tr class="group-single">
				<th class="table-summary-title" scope="row">Application fee</th>
				<td class="table-summary-content" itemprop="name">
					{{ ( lpa.payment.reducedFeeReceivesBenefits == true  ? 'The donor currently claims an eligible benefit for a reduced fee' :
					( lpa.payment.reducedFeeUniversalCredit == true  ? 'The donor receives Universal Credit' :
					( lpa.payment.reducedFeeLowIncome == true  ? 'The donor currently has an income of less than Â£12,000 a year before tax ' :
					'The donor is not applying for a reduced fee' ))) }}
				</td>
				<td class="table-summary-action"><a href="{{ url('lpa/fee-reduction', {'lpa-id': lpa.id}) }}">Edit</a></td>
			</tr>
		{% endif %}
	
	</tbody>

</table>