{% extends isPopup ? 'layout/twig/popup.twig' : 'layout/twig/layout.twig' %}

{% block pageTitle %}
    Create a lasting power of attorney 
{% endblock %}

{% block content %}

{% import "application/macros.twig" as macros %}

{% set form = formErrorTextExchange(form,  {
    'name' : {
        'cannot-be-blank' : 'Please enter the company\'s name'
    },
    'number' : {
        'cannot-be-blank' : 'Please enter the company\'s registration number'
    },
    'address-address1' : {
        'cannot-be-blank' : 'Please enter the company\'s first line of address'
    },
    'address-address2' : {
        'linked-1-cannot-be-null' : 'Please enter the second line of address'
    },
    'address-postcode' : {
        'linked-1-cannot-be-null' : 'Please enter the company\'s postcode'
    }
}) %}

{{ macros.formErrorSummary(error, form, 'There was a problem submitting the form') }}

{% if (seedDetailsPickerForm) %}
	{{ seedDetailsPickerForm.setAttribute('class', 'form') ? '' }}

    {% set pickerCsrf = seedDetailsPickerForm.get(seedDetailsPickerForm.csrfName()) %}
    {{ pickerCsrf.setAttributes({'id' : 'secret'}) ? '' }}
    {{ seedDetailsPickerForm.get('pick-details') ? '' }}
    {{ seedDetailsPickerForm.setAttributes({'id':'pick-details', 'class':'js-reusable'}) ? '' }}
    {{ seedDetailsPickerForm.setOptions({'label': 'Use these details', 'empty_option' : 'Choose a person'}) ? '' }}
    {% set pickerSubmit = seedDetailsPickerForm.get('submit') %}
    {{ pickerSubmit.setAttributes({'value': "Use this person's details", 'class' : 'button details-picker'}) ? '' }}
    {{ seedDetailsPickerForm.prepare() ? '' }}
{% endif %}

{# Set form fields variables #} 
{% set companyName = form.get('name') %}
{% set registrationNumber = form.get('number') %}
{% set email = form.get('email-address') %}
{% set address1 = form.get('address-address1') %}
{% set address2 = form.get('address-address2') %}
{% set address3 = form.get('address-address3') %}
{% set postcode = form.get('address-postcode') %}

{# form fields config #}
{{ form.setAttributes({
    'class':'form form-condensed js-PersonForm js-PostcodeLookup'
}) ? '' }}

{{ companyName.setAttributes({
    id: 'name',
    class: 'form-control'
}) ? '' }}

{{ registrationNumber.setAttributes({
    id: 'number',
    class: 'form-control'
}) ? '' }}

{{ email.setAttributes({
    id: 'email-address',
    class: 'form-control'
}) ? '' }}

{{ address1.setAttributes({
    id: 'address-address1',
    class: 'form-control'
}) ? ''}}

{{ address2.setAttributes({
    id: 'address-address2',
    class: 'form-control'
}) ? ''}}

{{ address3.setAttributes({
    id: 'address-address3',
    class: 'form-control'
}) ? ''}}

{{ postcode.setAttributes({
    id: 'address-postcode',
    class: 'form-control'
}) ? ''}}

{# form fields labels #}
{{ companyName.setOptions({label:'Company name'}) ? '' }}
{{ registrationNumber.setOptions({label:'Registration No.'}) ? '' }}
{{ email.setOptions({label:'Email address'}) ? '' }}
{{ address1.setOptions({label:'Address line 1'}) ? '' }}
{{ address2.setOptions({label:'Address line 2'}) ? '' }}
{{ address3.setOptions({label:'Address line 3'}) ? '' }}
{{ postcode.setOptions({label:'Postcode'}) ? '' }}

<header class="popup-header">
    <i class="icon icon-person"></i>
    <h2 class="heading-small popup-header-title">Edit trust corporation details</h2>
</header>
    
{{ form.prepare() ? '' }}

{############################ trust corp form ############################}

{% if (useTrustRoute) %}
<div class="panel-actions">
    <a href="{{ useTrustRoute }}" class="js-form-popup" >Use details of the {{ trustName }}</a>
</div>
{% endif %}

{% if (addAttorneyRoute) %}
<div class="panel-actions">
    <a href="{{ addAttorneyRoute }}" class="js-form-popup" >Using an individual?</a>
</div>
{% endif %}

{# begin form #}
{{ form().openTag( form )|raw }}
    {{ formElement(form.get( form.csrfName )) }}

    <h2 class="heading-medium">Company's details</h2>

    <fieldset>
        <legend class="visuallyhidden">Add company details</legend>

        {{ macros.formGroup(companyName) }}
        {{ macros.formGroup(registrationNumber) }}
        {{ macros.formGroup(email) }}

    </fieldset>

    <h2 class="heading-medium">What is the company's address?</h2>

    <fieldset class="postcodelookup">
        <legend class="visuallyhidden">Address</legend>
        <div class="js-PostcodeLookup__postal-add">
            {{ macros.formGroup(address1) }}
            {{ macros.formGroup(address2) }}
            {{ macros.formGroup(address3) }}
            {{ macros.formGroup(postcode) }}
        </div>
    </fieldset>

    <input type="submit" name="submit" id="form-save" value="Save details" class="button">
    <a href="{{ cancelRoute }}" class="button button-secondary js-cancel">Cancel</a>

{{ form().closeTag|raw }}

{% endblock %}