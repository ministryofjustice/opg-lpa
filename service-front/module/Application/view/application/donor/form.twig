{% import "application/macros.twig" as macros %}

<script type="text/javascript">
	var actors = {names: {{ actorsList(lpa, routeMatch)|json_encode() }}};
</script>

{% set form = formErrorTextExchange(form,  {
	'dob-date-day' : {
            "Value is required and can't be empty" : "Please enter a day"
     },
     'dob-date-month' : {
            "Value is required and can't be empty" : "Please enter a month"
     },
     'dob-date-year' : {
            "Value is required and can't be empty" : "Please enter a year"
     }
}) %}

{{ macros.formErrorSummary(error, form, 'There was a problem submitting the form') }}

{% if (seedDetailsPickerForm) %}
    {{ seedDetailsPickerForm.setAttribute('class', 'form') ? '' }}
    {% set pickerCsrf = seedDetailsPickerForm.get(seedDetailsPickerForm.csrfName()) %}
    {{ pickerCsrf.setAttributes({'id' : 'secret'}) ? '' }}
    {{ seedDetailsPickerForm.get('pick-details') ? '' }}
    {{ seedDetailsPickerForm.setAttributes({'id':'pick-details', 'class':'js-reusable'}) ? '' }}
    {{ seedDetailsPickerForm.setOptions({'label': 'Use these details', 'empty_option' : 'Choose a person'}) ? '' }}
    {% set pickerSubmit = seedDetailsPickerForm.get('submit') %}
    {{ pickerSubmit.setAttributes({'value': "Use this person's details", 'class' : 'button details-picker'}) ? '' }}
{% endif %}

{% set title = form.get('name-title') %}
{% set firstname = form.get('name-first') %}
{% set lastname = form.get('name-last') %}
{% set otherNames = form.get('otherNames') %}
{% set email = form.get('email-address') %}
{% set address1 = form.get('address-address1') %}
{% set address2 = form.get('address-address2') %}
{% set address3 = form.get('address-address3') %}
{% set postcode = form.get('address-postcode') %}
{% set canSign = form.get('canSign') %}
{% set dob = form.get('dob-date') %}
{% set dobDay = dob.get('day') %}
{% set dobMonth = dob.get('month') %}
{% set dobYear = dob.get('year') %}

{{ dobDay.setAttributes({'maxlength':'2','pattern': '[0-9]{2}'}) ? '' }}
{{ dobMonth.setAttributes({'maxlength':'2','pattern': '[0-9]{2}'}) ? '' }}
{{ dobYear.setAttributes({'maxlength':'4','pattern': '[0-9]{4}'}) ? '' }}

{{ form.setAttributes({'class':'form js-PersonForm js-PostcodeLookup', 'novalidate': ''}) ? '' }}

{{ title.setOptions({label:'Title'}) ? '' }}
{{ title.setAttributes({id:'name-title'}) ? '' }}

{{ firstname.setOptions({label:'First name'}) ? '' }}
{{ firstname.setAttributes({id:'name-title'}) ? '' }}

{{ lastname.setOptions({label:'Last name'}) ? '' }}
{{ lastname.setAttributes({id:'name-title'}) ? '' }}

{{ otherNames.setOptions({label:'Other names'}) ? '' }}

{{ dob.setOptions({label:'Date of Birth'}) ? '' }}
{{ dobDay.setOptions({label:'Day'}) ? '' }}
{{ dobMonth.setOptions({label:'Month'}) ? '' }}
{{ dobYear.setOptions({label:'Year'}) ? '' }}
{{ dobDay.setAttribute('id', 'dob-date-day') ? '' }}
{{ dobMonth.setAttribute('id', 'dob-date-month') ? '' }}
{{ dobYear.setAttribute('id', 'dob-date-year') ? '' }}

{{ email.setOptions({label:'Email address'}) ? '' }}
{{ address1.setOptions({label:'Address line 1'}) ? '' }}
{{ address2.setOptions({label:'Address line 2'}) ? '' }}
{{ address3.setOptions({label:'Address line 3'}) ? '' }}
{{ postcode.setOptions({label:'Postcode'}) ? '' }}
{{ canSign.setOptions({label:'This person cannot physically sign the LPA'}) ? '' }}
{{ address1.setAttributes({id:'address-address1'}) ? '' }}
{{ canSign.setAttributes({class:'donor-cannot-sign'}) ? '' }}

{{ form.prepare() ? '' }}

<h2 class="header">Edit the donor's details</h2>

{############################ picker form ############################}

{% if (pickerForm) %}
{{ form().openTag(pickerForm)|raw }}
{{ formElement(pickerCsrf) }}

    <div class="role-select group">
        <label>{{ picker.getOption('label') }}</label>
        {{ formSelect(picker) }}
        {{ formElementErrors(picker) }}
        {{ formSubmit(pickerSubmit) }}
    </div>

{{ form().closeTag|raw }}
    
{% endif %}

{############################ donor form ############################}

{{ form().openTag( form )|raw }}

{% if (useMyDetailsRoute) %}
<p class="role-select group">
    <a class="js-form-popup" href="{{ useMyDetailsRoute }}">Use my details</a>
</p>
{% endif %}

{{ formElement(form.get( form.csrfName )) }}

<fieldset>

{{ macros.renderElementDiv(title) }}
{{ macros.renderElementDiv(firstname) }}
{{ macros.renderElementDiv(lastname) }}

    <details{{ otherNames.getValue() ? '' : ' open' }}>
        <summary class="hint" role="button" aria-expanded="false">Is this person known by any other names?</summary>
        <div class="group">
            {{ macros.renderElementDiv(otherNames) }}
        </div>
    </details>

    <div class="{{ elementGroupClass(dob) }}">
        
        <label for="dob" id="dob-label" class="required">Date of birth</label>

        <div class="dob-element">

            <div class="form-group form-group-day">
                <label class="form-label" for="{{ dobDay.getAttribute('id') }}">{{ dobDay.getOption('label') }}</label>
                {{ formElement(dobDay) }}
            </div>

            <div class="form-group form-group-month">
                <label class="form-label" for="{{ dobMonth.getAttribute('id') }}">{{ dobMonth.getOption('label') }}</label>
                {{ formElement(dobMonth) }}
            </div>

            <div class="form-group form-group-year">
                <label class="form-label" for="{{ dobYear.getAttribute('id') }}">{{ dobYear.getOption('label') }}</label>
                {{ formElement(dobYear) }}
            </div>

        </div>
        
        {{ formElementErrorsV2(dobDay) }}
        {{ formElementErrorsV2(dobMonth) }}
        {{ formElementErrorsV2(dobYear) }}
        {{ formElementErrorsV2(dob) }}
        
    </div>

{{ macros.renderElementDiv(email) }}

</fieldset>

<h2 class="heading-medium">What is your address?</h2>

<fieldset class="js-PostcodeLookup__postal-add">
    {{ macros.renderElementDiv(address1) }}
    {{ macros.renderElementDiv(address2) }}
    {{ macros.renderElementDiv(address3) }}
    {{ macros.renderElementDiv(postcode) }}
</fieldset>

{{ macros.renderElementDiv(address3) }}

<fieldset id="donor-sign">
<div class="option group">
    <label>
    {{ formcheckbox(canSign) }}
    {{ canSign.getOption('label') }}
    </label>
    <span class="hint">We'll include an extra signature sheet so someone can sign on their behalf</span>
    {{ formElementErrorsV2(canSign) }}
</div>
</fieldset>

<p class="action group">
<input type="submit" name="submit" id="form-save" value="Save details" class="button">
<button name="cancel" type="button" class="button-secondary">Cancel</button>
</p>

{{ form().closeTag|raw }}

