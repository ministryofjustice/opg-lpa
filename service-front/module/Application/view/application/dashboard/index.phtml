<?php if ($this->lastLogin) : ?>
    <div style="float:right;">You were last signed in on <?= $this->lastLogin ?></div>
<?php endif; ?>

<?php if ($this->message): ?>

    <h3><?php echo $this->message ?></h3>

<?php else: ?>

    <div class="dashboard-header indent-2em">

        <?php if ($this->lpas->getTotalItemCount() == 0): ?>

            <?php if ($this->isSearch): ?>
                <p>Your search has found no results</p>
            <?php else: ?>
                <p>You haven't created any LPAs yet.</p>
            <?php endif; ?>

        <?php else: ?>

            <?php if ($this->isSearch): ?>
                <p>Your search has found these results</p>
            <?php else: ?>
                <p>On this page you'll find all the LPAs that you've created. As well as creating a new LPA from
                    scratch, you can:</p>
                <div>
                    <ul>
                        <li><strong>Continue creating</strong> an LPA</li>
                        <li>Check that the <strong>signing dates</strong> on an LPA are in the right order before you
                            register it. (If they're not in the right order, you risk having to repay some or all of the
                            application fee.)
                        </li>
                        <li><strong>Reuse details</strong> from an existing LPA to create a new one and save you
                            entering some information twice
                        </li>
                    </ul>
                </div>
            <?php endif; ?>

        <?php endif; ?>

    </div>

<?php endif; ?>

<div class="toolbar toolbar__dashboard">

    <div class="tool tool__search">
        <form action="<?= $this->url('user/dashboard') ?>" method="GET">
            <input type="text" name="search"
                   placeholder="LPA no, donor's first or last name"
                   value="<?php echo isset($this->freeText) ? $this->escapeHtmlAttr( $this->freeText ) : ''; ?>"/>
            <input class="add button button" type="submit" value="Search"/>
        </form>

    </div>
    <div class="tool tool__create">
        <a class="add button" href='<?php echo $this->url('user/dashboard/create-lpa') ?>' role="button">Create a new
            LPA</a>
    </div>

</div>

<?php if ($this->lpas->getTotalItemCount() > 0) : ?>
<table id="savedforms" class="lpa-list">
    <thead>
    <tr>
        <th>LPA number</th>
        <th>Donor</th>
        <th>Type</th>
        <th>Progress</th>
        <th>Last saved on</th>
        <th>&nbsp;</th>
    </tr>
    </thead>
    <tbody>
    <?php foreach ($this->lpas as $lpa): ?>
        <?php if ($lpa->version == 2): ?>
            <tr>
                <td><?= \Opg\Lpa\DataModel\Lpa\Formatter::id($lpa->id) ?></td>
                <td><?= $lpa->donor; ?></td>
                <td><?= ($lpa->type == 'property-and-financial') ? 'PF' : (($lpa->type == 'health-and-welfare') ? 'HW' : '') ?></td>
                <td><?= $lpa->progress ?></td>
                <td><?= $lpa->updatedAt->format('d/m/y'); ?></td>
                <td>
                    <div class="lpa-actions">
                        <a class="button"
                           href="/lpa/<?= $lpa->id ?>"><?= ($lpa->progress == 'Completed') ? 'View LPA' : 'Continue' ?></a>

                        <?php if ($lpa->progress == 'Completed'): ?>
                            <a class="button-secondary" href="/lpa/<?= $lpa->id ?>/date-check">Check dates</a>
                        <?php endif; ?>

                        <?php if ($lpa->progress != 'Started'): ?>
                            <a class="button-secondary"
                               href="<?= $this->url('user/dashboard/create-lpa', ['lpa-id' => $lpa->id]) ?>">Reuse
                                details</a>
                        <?php endif; ?>

                        <a class="button-warning delete-lpa"
                           href="/user/dashboard/delete-lpa/<?= $lpa->id ?>">Delete</a>
                    </div>
                </td>
            </tr>
        <?php else: ?>
            <tr>
                <td><?= $lpa->id ?></td>
                <td><?= $lpa->donor; ?></td>
                <td><?= ($lpa->type == 'property-and-financial') ? 'PF' : (($lpa->type == 'health-and-welfare') ? 'HW' : '') ?></td>
                <td><?= $lpa->status ?></td>
                <td><?= $lpa->updatedAt->format('d/m/y'); ?></td>
                <td>
                    <div class="lpa-actions">
                        <a class="button"
                           href="/forward/<?php if($lpa->status == 'Complete') echo 'completed'; elseif($lpa->status == 'Signed') echo 'registered'; elseif($lpa->status == 'Created') echo 'created'; else echo 'lpa'; ?>/<?= sprintf("%010d", $lpa->id) ?>"><?= ($lpa->status == 'Complete') ? 'View LPA' : 'Continue' ?></a>
                        <a class="button-warning delete-lpa" href="/service/delete/<?= sprintf("%010d", $lpa->id) ?>">Delete</a>
                    </div>
                </td>
            </tr>
        <?php endif; ?>
    <?php endforeach; ?>

    </tbody>
</table>

<? /* Pagination HTML is in pagination.phtml */ ?>
<?= $this->paginationControl($this->lpas, 'Sliding', 'pagination', ['route' => 'user/dashboard/pagination']); ?>

<p>
    <?php endif; ?>
  
  